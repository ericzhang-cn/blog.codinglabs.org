针对目前火爆的[2048](http://gabrielecirulli.github.io/2048/)游戏，[有人实现了一个AI程序](http://ov3y.github.io/2048-AI/)，可以以较大概率（高于90%）赢得游戏，并且[作者在stackoverflow上简要介绍了AI的算法框架和实现思路](http://stackoverflow.com/questions/22342854/what-is-the-optimal-algorithm-for-the-game-2048)。但是这个回答主要集中在启发函数的选取上，对AI用到的核心算法并没有仔细说明。这篇文章将主要分为两个部分，第一部分介绍其中用到的基础算法，即minimax和alpha-beta剪枝；第二部分分析作者具体的实现。

# 基础算法
2048本质上可以抽象成信息对称双人对弈模型（玩家向四个方向中的一个移动，然后计算机在某个空格中填入2或4）。这里“信息对称”是指在任一时刻对弈双方对格局的信息完全一致，移动策略仅依赖对接下来格局的推理。作者使用的核心算法为对弈模型中常用的带alpha-beta剪枝的minimax。这个算法也常被用于如国际象棋等信息对称对弈AI中。

## Minimax
下面先介绍不带剪枝的minimax。首先本文将通过一个简单的例子说明minimax算法的思路和决策方式。

### 问题
现在考虑这样一个游戏：有三个盘子A、B和C，每个盘子分别放有三张纸币。A放的是1、20、50；B放的是5、10、100；C放的是1、5、20。单位均为“元”。有甲、乙两人，两人均对三个盘子和上面放置的纸币有可以任意查看。游戏分三步：

1. 甲从三个盘子中选取一个。
2. 乙从甲选取的盘子中拿出两张纸币交给甲。
3. 甲从乙所给的两张纸币中选取一张，拿走。

其中甲的目标是最后拿到的纸币面值尽量大，乙的目标是让甲最后拿到的纸币面值尽量小。

下面用minimax算法解决这个问题。

### 基本思路
一般解决博弈类问题的自然想法是将格局组织成一棵树，树的每一个节点表示一种格局，而父子关系表示由父格局经过一步可以到达子格局。Minimax也不例外，它通过对以当前格局为根的格局树搜索来确定下一步的选择。而一切格局树搜索算法的核心都是对每个格局价值的评价。Minimax算法基于以下朴素思想确定格局价值：

+ Minimax是一种悲观算法，即假设对手每一步都会将我方引入从当前看理论上价值最小的格局方向，即对手具有完美决策能力。因此我方的策略应该是选择那些对方所能达到的让我方最差情况中最好的，也就是让对方在完美决策下所对我造成的损失最小。
+ Minimax不找理论最优解，因为理论最优解往往依赖于对手是否足够愚蠢，minimax中我方完全掌握主动，如果对方每一步决策都是完美的，则我方可以达到预计的最小损失格局，如果对方没有走出完美决策，则我方可能达到比预计的最悲观情况更好的结局。总之我方就是要在最坏情况中选择最好的。

上面的表述有些抽象，下面看具体示例。

### 解题
下图是上述示例问题的格局树：

<p class="picture"><img alt="" src="/uploads/pictures/2048-ai-analysis/01.png"/></p>

注意，由于示例问题格局数非常少，我们可以给出完整的格局树。这种情况下我可以找到minimax算法的全局最优解（注意和理论最优解区分，理论最优解假设对手每一步都愚蠢的走入我方价值最大的结局，而minimax的全局最优解假设对手每一步都是完美的，而我方找到的是全局最坏情况中最好的）。而真实情况中，格局树非常庞大，即使是计算机也不可能给出搜素整个树，因此我们往往只搜索一定深度，这时只能找到局部最优解。
